[pytest]
# Pytest Configuration for SaaS OCR Project

# Test Discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output Options
addopts =
    # Verbose output
    -v
    --tb=short

    # Coverage reporting
    --cov=backend/app
    --cov-report=html:test-reports/coverage-html
    --cov-report=xml:test-reports/coverage.xml
    --cov-report=term-missing
    --cov-branch

    # Test reports
    --html=test-reports/unit-tests-report.html
    --self-contained-html
    --json-report
    --json-report-file=test-reports/unit-tests-report.json

    # Parallel execution (use -n auto for automatic CPU detection)
    # Uncomment for parallel execution:
    # -n auto

    # Warnings
    --strict-markers
    --strict-config
    -W error::DeprecationWarning

    # Show slowest tests
    --durations=10

# Async support
asyncio_mode = auto

# Markers (for selective test execution)
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (require services)
    e2e: End-to-end tests (full system)
    slow: Tests that take more than 5 seconds
    smoke: Quick smoke tests
    security: Security-focused tests
    performance: Performance benchmarking tests
    api: API endpoint tests
    database: Database operation tests
    ocr: OCR processing tests
    llm: LLM extraction tests
    storage: Storage service tests
    celery: Celery task tests
    auth: Authentication tests
    payment: Payment processing tests
    ehr: EHR export tests
    analytics: Analytics tests

# Test organization
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    venv
    env
    __pycache__
    node_modules

# Coverage settings
[coverage:run]
source = backend/app
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */venv/*
    */env/*
    */migrations/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[coverage:html]
directory = test-reports/coverage-html
